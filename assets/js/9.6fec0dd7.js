(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{190:function(s,n,t){"use strict";t.r(n);var e=t(0),a=Object(e.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"_1、在-visual-studio-2017-中创建新项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、在-visual-studio-2017-中创建新项目"}},[s._v("#")]),s._v(" 1、在 Visual Studio 2017 中创建新项目")]),s._v(" "),t("ul",[t("li",[s._v("“文件”>“新建”>“项目”")]),s._v(" "),t("li",[s._v("从左侧菜单中选择“已安装”>“模板”>“Visual C#”>“.NET Core”。")]),s._v(" "),t("li",[s._v("选择“ASP.NET Core Web 应用程序”。")]),s._v(" "),t("li",[s._v("输入“EFGetStarted.AspNetCore.NewDb”作为名称，然后单击“确定”。")]),s._v(" "),t("li",[s._v("在“新建 ASP.NET Core Web 应用程序”对话框中：")])]),s._v(" "),t("ol",[t("li",[s._v("确保在下拉列表中选择“.NET Core”和“ASP.NET Core 2.0”选项")]),s._v(" "),t("li",[s._v("选择“Web 应用程序(模型视图控制器)”项目模板")]),s._v(" "),t("li",[s._v("确保将“身份验证”设置为“无身份验证”")]),s._v(" "),t("li",[s._v("单击“确定”")])]),s._v(" "),t("h3",{attrs:{id:"_2、安装-entity-framework-core"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装-entity-framework-core"}},[s._v("#")]),s._v(" 2、安装 Entity Framework Core")]),s._v(" "),t("p",[s._v("工具”>“NuGet 包管理器”>“包管理器控制台”")]),s._v(" "),t("h6",{attrs:{id:"_1-安装数据库提供程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装数据库提供程序"}},[s._v("#")]),s._v(" 1.安装数据库提供程序")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("MsSql\n运行：Install-Package Microsoft.EntityFrameworkCore.SqlServer\nMySql\n运行：\n柚子：Install-Package Pomelo.EntityFrameworkCore.MySql\n或者\n官方:Install-Package MySql.Data.EntityFrameworkCore -Version 8.0.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h6",{attrs:{id:"_2-安装程序包管理器控制台"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装程序包管理器控制台"}},[s._v("#")]),s._v(" 2.安装程序包管理器控制台")]),s._v(" "),t("p",[s._v("==运行：Install-Package Microsoft.EntityFrameworkCore.Tools==")]),s._v(" "),t("h6",{attrs:{id:"_3-安装设计包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装设计包"}},[s._v("#")]),s._v(" 3.安装设计包")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("运行：Install-Package Microsoft.EntityFrameworkCore.Design\n数据据库提供程序设计包 (EF Core 2.0 不再需要)\nMsSql\n运行：Install-Package Microsoft.EntityFrameworkCore.SqlServer.Design\nMySql\n运行：Install-Package Pomelo.EntityFrameworkCore.MySql.Design\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("blockquote",[t("p",[s._v("随着官方版本的更新，可能会出现报错,在此我展示我使用的版本。\n"),t("img",{attrs:{src:"https://men-hulu.github.io/efcore/1-1.png",alt:"image"}})])]),s._v(" "),t("h3",{attrs:{id:"db-first——从现有数据库创建模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#db-first——从现有数据库创建模型"}},[s._v("#")]),s._v(" DB First——从现有数据库创建模型")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('MySql\n运行：Scaffold-DbContext -Connection "server=111.231.132.***;port=3306;uid=ymj;pwd=******;database=test;charset=utf8;sslmode=none;" -Provider "MySql.Data.EntityFrameworkCore" -OutputDir "Models"\n\nMsSql\n运行：Scaffold-DbContext -Connection "server=111.231.132.***;port=3306;uid=ymj;pwd=******;database=test;charset=utf8;sslmode=none;" -Provider "Microsoft.EntityFrameworkCore.SqlServer" -OutputDir "Models"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("从数据库更新DbContext和实体的类型\nScaffold-DbContext \n-Connection <String>\t数据库的连接字符串。\n-Provider <String>\t要使用的提供程序。 （例如 Microsoft.EntityFrameworkCore.SqlServer)\n-OutputDir <String >\t要将文件放入的目录。 路径是相对于项目目录。\n-Context <String >\t若要生成的 dbcontext 名称。\n-Schemas <String[]>\t要生成实体类型的表架构。\n-Tables <String[]>\t要生成实体类型的表。\n-DataAnnotations\t使用属性来配置该模型 （如果可能）。 如果省略，则使用仅 fluent API。\n-UseDatabaseNames\t使用直接从数据库表和列名称。\n-Force 覆盖现有文件。\n\n从迁移中生成的 SQL 脚本\nScript-Migration\n-From <String>\t开始迁移。 默认值为 0 （初始数据库）\n-To <String>\t结束的迁移。 默认到最后一个迁移\n-Idempotent\t生成可以在任何迁移的数据库使用的脚本\n-Output <String>\t要将结果写入的文件\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"code-first——从模型生成到数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#code-first——从模型生成到数据库"}},[s._v("#")]),s._v(" Code First——从模型生成到数据库")]),s._v(" "),t("h4",{attrs:{id:"_1、创建模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建模型"}},[s._v("#")]),s._v(" 1、创建模型")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('namespace Model\n{\n    public class SchoolContext : DbContext\n    {\n        public SchoolContext(DbContextOptions<SchoolContext> options) : base(options)\n        {\n        }\n\n        public DbSet<Course> Courses { get; set; }\n        public DbSet<Enrollment> Enrollments { get; set; }\n        public DbSet<Student> Students { get; set; }\n\n        protected override void OnModelCreating(ModelBuilder modelBuilder)\n        {\n            modelBuilder.Entity<Course>().ToTable("Course");\n            modelBuilder.Entity<Enrollment>().ToTable("Enrollment");\n            modelBuilder.Entity<Student>().ToTable("Student");\n        }\n    }\n    public class Student\n    {\n        public int ID { get; set; }\n        public string LastName { get; set; }\n        public string FirstMidName { get; set; }\n        public DateTime EnrollmentDate { get; set; }\n\n        public ICollection<Enrollment> Enrollments { get; set; }\n    }\n    public enum Grade\n    {\n        A, B, C, D, F\n    }\n\n    public class Enrollment\n    {\n        public int EnrollmentID { get; set; }\n        public int CourseID { get; set; }\n        public int StudentID { get; set; }\n        public Grade? Grade { get; set; }\n\n        public Course Course { get; set; }\n        public Student Student { get; set; }\n    }\n\n    public class Course\n    {\n        [DatabaseGenerated(DatabaseGeneratedOption.None)]\n        public int CourseID { get; set; }\n        public string Title { get; set; }\n        public int Credits { get; set; }\n\n        public ICollection<Enrollment> Enrollments { get; set; }\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("h4",{attrs:{id:"_1-2、startup文件注入上下文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、startup文件注入上下文"}},[s._v("#")]),s._v(" 1.2、Startup文件注入上下文")]),s._v(" "),t("p",[s._v("EF Core在版本 2.0 中，引入了一种在依赖关系注入中注册自定义 DbContext 类型的新方法，即以透明形式引入可重用 DbContext 实例的池。\n要使用 DbContext 池，请在服务注册期间使用 AddDbContextPool 而不是 AddDbContext")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('public void ConfigureServices(IServiceCollection services)\n{\nservices.AddDbContextPool<SchoolContext>(options =>\noptions.UseMySql(Configuration.GetConnectionString("DefaultConnection")));\n\nservices.AddMvc().AddJsonOptions(options =>\noptions.SerializerSettings.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Ignore);\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"_1-3、appsettings-json文件添加连接字符串"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3、appsettings-json文件添加连接字符串"}},[s._v("#")]),s._v(" 1.3、appsettings.json文件添加连接字符串")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  "ConnectionStrings": {\n    "test": "server=111.231.132.***;port=3306;uid=ymj;pwd=******;database=test;charset=utf8;sslmode=none;"\n  },\n  "Logging": {\n    "LogLevel": {\n      "Default": "Warning"\n    }\n  },\n  "AllowedHosts": "*"\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('2.1、为迁移搭建基架\n\n运行：Add-Migration InitialCreate\n\n2.2、将新迁移应用到数据库\n\n运行：Update-Database\n\nEF Core 2.0 NuGet命令\n\nGet-Help about_EntityFrameworkCore 获取EF Core命令帮助\n\n添加一个迁移数据库 迁移的名称 目录（及其子命名空间）路径是相对于项目目录。 默认值为"Migrations"。\nAdd-Migration -Name <String> -OutputDir <String>\t\nAdd-Migration InitialCreate 第一次执行初始化用这个\n\n删除上次的迁移数据库 不检查以查看迁移是否已应用到数据库。\nRemove-Migration -Force\n\n目标迁移。 如果为"0"，将恢复所有迁移。 默认到最后一个迁移。\nUpdate-Database \nUpdate-Database LastGoodMigration 还原迁移\n\n删除数据库 显示的数据库会被丢弃，但没有删除它\nDrop-Database -WhatIf\n\nGet-DbContext 获取有关 DbContext 类型的信息\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])])])}),[],!1,null,null,null);n.default=a.exports}}]);